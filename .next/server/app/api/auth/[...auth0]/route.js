"use strict";(()=>{var e={};e.id=599,e.ids=[599],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},21820:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>u});var i=r(49303),o=r(88716),s=r(60670),a=r(41205);let c=(0,a.handleAuth)(),u=(0,a.handleAuth)(),p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/[...auth0]/route",pathname:"/api/auth/[...auth0]",filename:"route",bundlePath:"app/api/auth/[...auth0]/route"},resolvedPagePath:"/Users/bash/Documents/GitHub/crypticApp/src/app/api/auth/[...auth0]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:l,serverHooks:d}=p,f="/api/auth/[...auth0]/route";function w(){return(0,s.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:l})}},71715:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clientGetter=t.EdgeClient=void 0;let n=r(82174),i=n.__importStar(r(91604)),o=n.__importStar(r(39797)),s=r(62446),a=r(11594),c=r(96501),u=n.__importDefault(r(86711)),p=e=>{let t=new TextEncoder().encode(e),r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))};class h extends s.AbstractClient{constructor(e,t){if(super(e,t),this.config=e,this.telemetry=t,"code"!==e.authorizationParams.response_type)throw Error("This SDK only supports `response_type=code` when used in an Edge runtime.");this.httpOptions=()=>{let r=new Headers;if(e.enableTelemetry){let{name:e,version:n}=t;r.set("User-Agent",`${e}/${n}`),r.set("Auth0-Client",p(JSON.stringify({name:e,version:n,env:{edge:!0}})))}return{signal:AbortSignal.timeout(this.config.httpTimeout),headers:r}}}async getClient(){if(this.as)return[this.as,this.client];let e=new URL(this.config.issuerBaseURL);try{this.as=await i.discoveryRequest(e,this.httpOptions()).then(t=>i.processDiscoveryResponse(e,t))}catch(e){throw new a.DiscoveryError(e,this.config.issuerBaseURL)}if(this.config.pushedAuthorizationRequests&&!this.as.pushed_authorization_request_endpoint)throw TypeError("pushed_authorization_request_endpoint must be configured on the issuer to use pushedAuthorizationRequests");return this.client=Object.assign(Object.assign({client_id:this.config.clientID},!this.config.clientAssertionSigningKey&&{client_secret:this.config.clientSecret}),{token_endpoint_auth_method:this.config.clientAuthMethod,id_token_signed_response_alg:this.config.idTokenSigningAlg,[i.clockTolerance]:this.config.clockTolerance}),[this.as,this.client]}async authorizationUrl(e){let[t,r]=await this.getClient();if(this.config.pushedAuthorizationRequests){let{clientAssertionSigningKey:n,clientAssertionSigningAlg:s}=this.config,c=n;!c||c instanceof CryptoKey||(c=await o.importPKCS8(c,s||"RS256"));let u=await i.pushedAuthorizationRequest(t,r,e,Object.assign(Object.assign({},c&&{clientPrivateKey:c,[i.modifyAssertion](e,r){Array.isArray(r.aud)&&(r.aud=t.issuer)}}),this.httpOptions())),p=await i.processPushedAuthorizationResponse(t,r,u);if(i.isOAuth2Error(p))throw new a.IdentityProviderError({message:p.error_description||p.error,error:p.error,error_description:p.error_description});e={request_uri:p.request_uri}}let n=new URL(t.authorization_endpoint);return n.searchParams.set("client_id",this.config.clientID),Object.entries(e).forEach(([e,t])=>{null!=t&&n.searchParams.set(e,String(t))}),n.toString()}async callbackParams(e,t){let r;let[n,o]=await this.getClient(),s="GET"===e.getMethod().toUpperCase()?new URL(e.getUrl()):new URLSearchParams(await e.getBody());try{r=i.validateAuthResponse(n,o,s,t)}catch(e){throw new a.ApplicationError(e)}if(i.isOAuth2Error(r))throw new a.IdentityProviderError({message:r.error_description||r.error,error:r.error,error_description:r.error_description});return r}async callback(e,t,r,n){let[s,c]=await this.getClient(),{clientAssertionSigningKey:u,clientAssertionSigningAlg:p}=this.config,h=u;!h||h instanceof CryptoKey||(h=await o.importPKCS8(h,p||"RS256"));let l=await i.authorizationCodeGrantRequest(s,c,t,e,r.code_verifier,Object.assign(Object.assign({additionalParameters:n.exchangeBody},h&&{clientPrivateKey:h,[i.modifyAssertion](e,t){Array.isArray(t.aud)&&(t.aud=s.issuer)}}),this.httpOptions())),d=await i.processAuthorizationCodeOpenIDResponse(s,c,l,r.nonce,r.max_age);if(i.isOAuth2Error(d))throw new a.IdentityProviderError({message:d.error_description||d.error,error:d.error,error_description:d.error_description});return d}async endSessionUrl(e){let[t]=await this.getClient(),r=new URL(t.issuer);if(this.config.idpLogout&&(this.config.auth0Logout||r.hostname.match("\\.auth0\\.com$")&&!1!==this.config.auth0Logout)){let{post_logout_redirect_uri:r}=e,i=n.__rest(e,["post_logout_redirect_uri"]),o=new URL((0,u.default)(t.issuer,"/v2/logout"));return r&&o.searchParams.set("returnTo",r),o.searchParams.set("client_id",this.config.clientID),Object.entries(i).forEach(([e,t])=>{null!=t&&o.searchParams.set(e,t)}),o.toString()}if(!t.end_session_endpoint)throw Error("RP Initiated Logout is not supported on your Authorization Server.");let i=new URL(t.end_session_endpoint);return Object.entries(e).forEach(([e,t])=>{null!=t&&i.searchParams.set(e,t)}),i.searchParams.set("client_id",this.config.clientID),i.toString()}async userinfo(e){let[t,r]=await this.getClient(),n=await i.userInfoRequest(t,r,e,this.httpOptions());try{return await i.processUserInfoResponse(t,r,i.skipSubjectCheck,n)}catch(e){throw new a.UserInfoError(e.message)}}async refresh(e,t){let[r,n]=await this.getClient(),{clientAssertionSigningKey:s,clientAssertionSigningAlg:u}=this.config,p=s;!p||p instanceof CryptoKey||(p=await o.importPKCS8(p,u||"RS256"));let h=await i.refreshTokenGrantRequest(r,n,e,Object.assign(Object.assign({additionalParameters:t.exchangeBody},p&&{clientPrivateKey:p,[i.modifyAssertion](e,t){Array.isArray(t.aud)&&(t.aud=r.issuer)}}),this.httpOptions())),l=await i.processRefreshTokenResponse(r,n,h);if(i.isOAuth2Error(l))throw new c.AccessTokenError(c.AccessTokenErrorCode.FAILED_REFRESH_GRANT,"The request to refresh the access token failed.",new a.IdentityProviderError({message:l.error_description||l.error,error:l.error,error_description:l.error_description}));return l}generateRandomCodeVerifier(){return i.generateRandomCodeVerifier()}generateRandomNonce(){return i.generateRandomNonce()}calculateCodeChallenge(e){return i.calculatePKCECodeChallenge(e)}async getIssuerMetadata(){let[e]=await this.getClient();return e}}t.EdgeClient=h,t.clientGetter=e=>{let t;return async r=>(t||(t=new h(r,e)),t)}},41205:(e,t,r)=>{let n;Object.defineProperty(t,"__esModule",{value:!0}),t.withMiddlewareAuthRequired=t.handleAuth=t.handleProfile=t.handleCallback=t.handleLogout=t.handleLogin=t.withPageAuthRequired=t.withApiAuthRequired=t.touchSession=t.getAccessToken=t.updateSession=t.getSession=t.initAuth0=void 0;let i=r(82174),o=r(89083),s=r(30662),a=r(71715),c=()=>{let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")};function u(){return((0,s.setIsUsingNamedExports)(),n)?n:n=(0,o._initAuth)({genId:c,clientGetter:a.clientGetter})}t.initAuth0=e=>((0,s.setIsUsingOwnInstance)(),(0,o._initAuth)({genId:c,clientGetter:a.clientGetter,params:e})),t.getSession=(...e)=>u().getSession(...e),t.updateSession=(...e)=>u().updateSession(...e),t.getAccessToken=(...e)=>u().getAccessToken(...e),t.touchSession=(...e)=>u().touchSession(...e),t.withApiAuthRequired=(...e)=>u().withApiAuthRequired(...e),t.withPageAuthRequired=(...e)=>u().withPageAuthRequired(...e),t.handleLogin=(...e)=>u().handleLogin(...e),t.handleLogout=(...e)=>u().handleLogout(...e),t.handleCallback=(...e)=>u().handleCallback(...e),t.handleProfile=(...e)=>u().handleProfile(...e),t.handleAuth=(...e)=>u().handleAuth(...e),t.withMiddlewareAuthRequired=(...e)=>u().withMiddlewareAuthRequired(...e),i.__exportStar(r(20076),t)},49303:(e,t,r)=>{e.exports=r(30517)},38238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},95014:(e,t)=>{function r(e,t){let r;let n=e.split("/");return(t||[]).some(t=>!!n[1]&&n[1].toLowerCase()===t.toLowerCase()&&(r=t,n.splice(1,1),e=n.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizeLocalePath",{enumerable:!0,get:function(){return r}})},37847:(e,t)=>{function r(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removeTrailingSlash",{enumerable:!0,get:function(){return r}})},91604:(e,t,r)=>{let n,i,o;function s(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}r.r(t),r.d(t,{OperationProcessingError:()=>_,UnsupportedOperationError:()=>b,authorizationCodeGrantRequest:()=>eJ,calculatePKCECodeChallenge:()=>q,clientCredentialsGrantRequest:()=>e$,clockSkew:()=>a,clockTolerance:()=>c,customFetch:()=>u,deviceAuthorizationRequest:()=>ta,deviceCodeGrantRequest:()=>tu,discoveryRequest:()=>x,expectNoNonce:()=>eI,expectNoState:()=>tn,experimentalCustomFetch:()=>tw,experimentalUseMtlsAlias:()=>ty,experimental_customFetch:()=>tm,experimental_jwksCache:()=>tS,experimental_useMtlsAlias:()=>tg,experimental_validateDetachedSignatureResponse:()=>tb,experimental_validateJwtAccessToken:()=>t_,generateKeyPair:()=>th,generateRandomCodeVerifier:()=>L,generateRandomNonce:()=>J,generateRandomState:()=>D,genericTokenEndpointRequest:()=>eM,getValidatedIdTokenClaims:()=>eP,introspectionRequest:()=>eZ,isOAuth2Error:()=>es,issueRequestObject:()=>Q,jweDecrypt:()=>h,jwksCache:()=>l,modifyAssertion:()=>p,parseWwwAuthenticateChallenges:()=>eu,processAuthorizationCodeOAuth2Response:()=>eK,processAuthorizationCodeOpenIDResponse:()=>eH,processClientCredentialsResponse:()=>eG,processDeviceAuthorizationResponse:()=>tc,processDeviceCodeResponse:()=>tp,processDiscoveryResponse:()=>O,processIntrospectionResponse:()=>eX,processPushedAuthorizationResponse:()=>ep,processRefreshTokenResponse:()=>ex,processRevocationResponse:()=>eB,processUserInfoResponse:()=>eg,protectedResourceRequest:()=>eh,pushedAuthorizationRequest:()=>eo,refreshTokenGrantRequest:()=>ev,revocationRequest:()=>eF,skipAuthTimeCheck:()=>eW,skipStateCheck:()=>tr,skipSubjectCheck:()=>em,useMtlsAlias:()=>d,userInfoRequest:()=>el,validateAuthResponse:()=>ti,validateDetachedSignatureResponse:()=>e9,validateIdTokenSignature:()=>eA,validateJwtAccessToken:()=>tf,validateJwtAuthResponse:()=>e3,validateJwtIntrospectionSignature:()=>eE,validateJwtUserInfoSignature:()=>eT,validateJwtUserinfoSignature:()=>tv}),"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(n="oauth4webapi/v2.17.0");let a=Symbol(),c=Symbol(),u=Symbol(),p=Symbol(),h=Symbol(),l=Symbol(),d=Symbol(),f=new TextEncoder,w=new TextDecoder;function m(e){return"string"==typeof e?f.encode(e):w.decode(e)}function y(e){return"string"==typeof e?function(e){try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch(e){throw new v("The input to be decoded is not correctly encoded.",{cause:e})}}(e):function(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(e)}class g{constructor(e){this.cache=new Map,this._cache=new Map,this.maxSize=e}get(e){let t=this.cache.get(e);return t||((t=this._cache.get(e))?(this.update(e,t),t):void 0)}has(e){return this.cache.has(e)||this._cache.has(e)}set(e,t){return this.cache.has(e)?this.cache.set(e,t):this.update(e,t),this}delete(e){return this.cache.has(e)?this.cache.delete(e):!!this._cache.has(e)&&this._cache.delete(e)}update(e,t){this.cache.set(e,t),this.cache.size>=this.maxSize&&(this._cache=this.cache,this.cache=new Map)}}class b extends Error{constructor(e){super(e??"operation not supported"),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class _ extends Error{constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}let v=_,S=new g(100);function k(e){return e instanceof CryptoKey}function P(e){return k(e)&&"private"===e.type}let A=["PS256","ES256","RS256","PS384","ES384","RS384","PS512","ES512","RS512","EdDSA"];function R(e){try{let t=e.headers.get("dpop-nonce");t&&S.set(new URL(e.url).origin,t)}catch{}return e}function T(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function E(e){s(e,Headers)&&(e=Object.fromEntries(e.entries()));let t=new Headers(e);if(n&&!t.has("user-agent")&&t.set("user-agent",n),t.has("authorization"))throw TypeError('"options.headers" must not include the "authorization" header name');if(t.has("dpop"))throw TypeError('"options.headers" must not include the "dpop" header name');return t}function j(e){if("function"==typeof e&&(e=e()),!(e instanceof AbortSignal))throw TypeError('"options.signal" must return or be an instance of AbortSignal');return e}async function x(e,t){if(!(e instanceof URL))throw TypeError('"issuerIdentifier" must be an instance of URL');if("https:"!==e.protocol&&"http:"!==e.protocol)throw TypeError('"issuer.protocol" must be "https:" or "http:"');let r=new URL(e.href);switch(t?.algorithm){case void 0:case"oidc":r.pathname=`${r.pathname}/.well-known/openid-configuration`.replace("//","/");break;case"oauth2":"/"===r.pathname?r.pathname=".well-known/oauth-authorization-server":r.pathname=`.well-known/oauth-authorization-server/${r.pathname}`.replace("//","/");break;default:throw TypeError('"options.algorithm" must be "oidc" (default), or "oauth2"')}let n=E(t?.headers);return n.set("accept","application/json"),(t?.[u]||fetch)(r.href,{headers:Object.fromEntries(n.entries()),method:"GET",redirect:"manual",signal:t?.signal?j(t.signal):null}).then(R)}function C(e){return"string"==typeof e&&0!==e.length}async function O(e,t){let r;if(!(e instanceof URL))throw TypeError('"expectedIssuer" must be an instance of URL');if(!s(t,Response))throw TypeError('"response" must be an instance of Response');if(200!==t.status)throw new v('"response" is not a conform Authorization Server Metadata response');eV(t);try{r=await t.json()}catch(e){throw new v('failed to parse "response" body as JSON',{cause:e})}if(!T(r))throw new v('"response" body must be a top level object');if(!C(r.issuer))throw new v('"response" body "issuer" property must be a non-empty string');if(new URL(r.issuer).href!==e.href)throw new v('"response" body "issuer" does not match "expectedIssuer"');return r}function U(){return y(crypto.getRandomValues(new Uint8Array(32)))}function L(){return U()}function D(){return U()}function J(){return U()}async function q(e){if(!C(e))throw TypeError('"codeVerifier" must be a non-empty string');return y(await crypto.subtle.digest("SHA-256",m(e)))}function z(e){if(e instanceof CryptoKey)return{key:e};if(!(e?.key instanceof CryptoKey))return{};if(void 0!==e.kid&&!C(e.kid))throw TypeError('"kid" must be a non-empty string');return{key:e.key,kid:e.kid,modifyAssertion:e[p]}}function I(e){return encodeURIComponent(e).replace(/%20/g,"+")}function W(e){switch(e.algorithm.name){case"RSA-PSS":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new b("unsupported RsaHashedKeyAlgorithm hash name")}}(e);case"RSASSA-PKCS1-v1_5":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new b("unsupported RsaHashedKeyAlgorithm hash name")}}(e);case"ECDSA":return function(e){switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new b("unsupported EcKeyAlgorithm namedCurve")}}(e);case"Ed25519":case"Ed448":return"EdDSA";default:throw new b("unsupported CryptoKey algorithm name")}}function H(e){let t=e?.[a];return"number"==typeof t&&Number.isFinite(t)?t:0}function K(e){let t=e?.[c];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function N(){return Math.floor(Date.now()/1e3)}async function $(e,t,r,n,i){let o={alg:W(r),kid:n},s=function(e,t){let r=N()+H(t);return{jti:U(),aud:[e.issuer,e.token_endpoint],exp:r+60,iat:r,nbf:r,iss:t.client_id,sub:t.client_id}}(e,t);return i?.(o,s),X(o,s,r)}function M(e){if("object"!=typeof e||null===e)throw TypeError('"as" must be an object');if(!C(e.issuer))throw TypeError('"as.issuer" property must be a non-empty string');return!0}function G(e){if("object"!=typeof e||null===e)throw TypeError('"client" must be an object');if(!C(e.client_id))throw TypeError('"client.client_id" property must be a non-empty string');return!0}function F(e){if(!C(e))throw TypeError('"client.client_secret" property must be a non-empty string');return e}function B(e,t){if(void 0!==t)throw TypeError(`"options.clientPrivateKey" property must not be provided when ${e} client authentication method is used.`)}function V(e,t){if(void 0!==t)throw TypeError(`"client.client_secret" property must not be provided when ${e} client authentication method is used.`)}async function Z(e,t,r,n,i){switch(r.delete("client_secret"),r.delete("client_assertion_type"),r.delete("client_assertion"),t.token_endpoint_auth_method){case void 0:case"client_secret_basic":B("client_secret_basic",i),n.set("authorization",function(e,t){let r=I(e),n=I(t),i=btoa(`${r}:${n}`);return`Basic ${i}`}(t.client_id,F(t.client_secret)));break;case"client_secret_post":B("client_secret_post",i),r.set("client_id",t.client_id),r.set("client_secret",F(t.client_secret));break;case"private_key_jwt":{if(V("private_key_jwt",t.client_secret),void 0===i)throw TypeError('"options.clientPrivateKey" must be provided when "client.token_endpoint_auth_method" is "private_key_jwt"');let{key:n,kid:o,modifyAssertion:s}=z(i);if(!P(n))throw TypeError('"options.clientPrivateKey.key" must be a private CryptoKey');r.set("client_id",t.client_id),r.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),r.set("client_assertion",await $(e,t,n,o,s));break}case"tls_client_auth":case"self_signed_tls_client_auth":case"none":V(t.token_endpoint_auth_method,t.client_secret),B(t.token_endpoint_auth_method,i),r.set("client_id",t.client_id);break;default:throw new b("unsupported client token_endpoint_auth_method")}}async function X(e,t,r){if(!r.usages.includes("sign"))throw TypeError('CryptoKey instances used for signing assertions must include "sign" in their "usages"');let n=`${y(m(JSON.stringify(e)))}.${y(m(JSON.stringify(t)))}`,i=y(await crypto.subtle.sign(e2(r),r,m(n)));return`${n}.${i}`}async function Q(e,t,r,n){let i;M(e),G(t),r=new URLSearchParams(r);let{key:o,kid:s,modifyAssertion:a}=z(n);if(!P(o))throw TypeError('"privateKey.key" must be a private CryptoKey');r.set("client_id",t.client_id);let c=N()+H(t),u={...Object.fromEntries(r.entries()),jti:U(),aud:e.issuer,exp:c+60,iat:c,nbf:c,iss:t.client_id};r.has("resource")&&(i=r.getAll("resource"))&&i.length>1&&(u.resource=i);{let e=r.get("max_age");if(null!==e&&(u.max_age=parseInt(e,10),!Number.isFinite(u.max_age)))throw new v('"max_age" parameter must be a number')}{let e=r.get("claims");if(null!==e){try{u.claims=JSON.parse(e)}catch(e){throw new v('failed to parse the "claims" parameter as JSON',{cause:e})}if(!T(u.claims))throw new v('"claims" parameter must be a JSON with a top level object')}}{let e=r.get("authorization_details");if(null!==e){try{u.authorization_details=JSON.parse(e)}catch(e){throw new v('failed to parse the "authorization_details" parameter as JSON',{cause:e})}if(!Array.isArray(u.authorization_details))throw new v('"authorization_details" parameter must be a JSON with a top level array')}}let p={alg:W(o),typ:"oauth-authz-req+jwt",kid:s};return a?.(p,u),X(p,u,o)}async function Y(e,t,r,n,i,o){let{privateKey:s,publicKey:a,nonce:c=S.get(r.origin)}=t;if(!P(s))throw TypeError('"DPoP.privateKey" must be a private CryptoKey');if(!(k(a)&&"public"===a.type))throw TypeError('"DPoP.publicKey" must be a public CryptoKey');if(void 0!==c&&!C(c))throw TypeError('"DPoP.nonce" must be a non-empty string or undefined');if(!a.extractable)throw TypeError('"DPoP.publicKey.extractable" must be true');let u=N()+i,h={alg:W(s),typ:"dpop+jwt",jwk:await et(a)},l={iat:u,jti:U(),htm:n,nonce:c,htu:`${r.origin}${r.pathname}`,ath:o?y(await crypto.subtle.digest("SHA-256",m(o))):void 0};t[p]?.(h,l),e.set("dpop",await X(h,l,s))}async function ee(e){let{kty:t,e:r,n,x:o,y:s,crv:a}=await crypto.subtle.exportKey("jwk",e),c={kty:t,e:r,n,x:o,y:s,crv:a};return i.set(e,c),c}async function et(e){return i||(i=new WeakMap),i.get(e)||ee(e)}function er(e,t,r){if("string"!=typeof e){if(r)throw TypeError(`"as.mtls_endpoint_aliases.${t}" must be a string`);throw TypeError(`"as.${t}" must be a string`)}return new URL(e)}function en(e,t,r=!1){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?er(e.mtls_endpoint_aliases[t],t,r):er(e[t],t,r)}function ei(e,t){return!!(e.use_mtls_endpoint_aliases||t?.[d])}async function eo(e,t,r,n){M(e),G(t);let i=en(e,"pushed_authorization_request_endpoint",ei(t,n)),o=new URLSearchParams(r);o.set("client_id",t.client_id);let s=E(n?.headers);return s.set("accept","application/json"),n?.DPoP!==void 0&&await Y(s,n.DPoP,i,"POST",H(t)),eb(e,t,"POST",i,o,s,n)}function es(e){return!("object"!=typeof e||Array.isArray(e))&&null!==e&&void 0!==e.error}let ea=/((?:,|, )?[0-9a-zA-Z!#$%&'*+-.^_`|~]+=)/,ec=/(?:^|, ?)([0-9a-zA-Z!#$%&'*+\-.^_`|~]+)(?=$|[ ,])/g;function eu(e){if(!s(e,Response))throw TypeError('"response" must be an instance of Response');let t=e.headers.get("www-authenticate");if(null===t)return;let r=[];for(let{1:e,index:n}of t.matchAll(ec))r.push([e,n]);if(r.length)return r.map(([e,r],n,i)=>{let o=i[n+1];return function(e,t){let r=t.split(ea).slice(1);if(!r.length)return{scheme:e.toLowerCase(),parameters:{}};r[r.length-1]=r[r.length-1].replace(/,$/,"");let n={};for(let e=1;e<r.length;e+=2){var i;let t=e;if('"'===r[t][0])for(;'"'!==r[t].slice(-1)&&++e<r.length;)r[t]+=r[e];n[r[t-1].replace(/^(?:, ?)|=$/g,"").toLowerCase()]=(i=r[t]).length>=2&&'"'===i[0]&&'"'===i[i.length-1]?i.slice(1,-1):i}return{scheme:e.toLowerCase(),parameters:n}}(e,o?t.slice(r,o[1]):t.slice(r))})}async function ep(e,t,r){let n;if(M(e),G(t),!s(r,Response))throw TypeError('"response" must be an instance of Response');if(201!==r.status){let e;if(e=await e0(r))return e;throw new v('"response" is not a conform Pushed Authorization Request Endpoint response')}eV(r);try{n=await r.json()}catch(e){throw new v('failed to parse "response" body as JSON',{cause:e})}if(!T(n))throw new v('"response" body must be a top level object');if(!C(n.request_uri))throw new v('"response" body "request_uri" property must be a non-empty string');if("number"!=typeof n.expires_in||n.expires_in<=0)throw new v('"response" body "expires_in" property must be a positive number');return n}async function eh(e,t,r,n,i,o){if(!C(e))throw TypeError('"accessToken" must be a non-empty string');if(!(r instanceof URL))throw TypeError('"url" must be an instance of URL');return n=E(n),o?.DPoP===void 0?n.set("authorization",`Bearer ${e}`):(await Y(n,o.DPoP,r,t.toUpperCase(),H({[a]:o?.[a]}),e),n.set("authorization",`DPoP ${e}`)),(o?.[u]||fetch)(r.href,{body:i,headers:Object.fromEntries(n.entries()),method:t,redirect:"manual",signal:o?.signal?j(o.signal):null}).then(R)}async function el(e,t,r,n){M(e),G(t);let i=en(e,"userinfo_endpoint",ei(t,n)),o=E(n?.headers);return t.userinfo_signed_response_alg?o.set("accept","application/jwt"):(o.set("accept","application/json"),o.append("accept","application/jwt")),eh(r,"GET",i,o,null,{...n,[a]:H(t)})}function ed(e,t,r,n){o||(o=new WeakMap),o.set(e,{jwks:t,uat:r,get age(){return N()-this.uat}}),n&&Object.assign(n,{jwks:structuredClone(t),uat:r})}function ef(e,t){o?.delete(e),delete t?.jwks,delete t?.uat}async function ew(e,t,r){var n;let i,s,a;let{alg:c,kid:u}=r;if(function(e){if(!A.includes(e))throw new b('unsupported JWS "alg" identifier')}(c),!o?.has(e)&&!("object"!=typeof(n=t?.[l])||null===n||!("uat"in n)||"number"!=typeof n.uat||N()-n.uat>=300)&&"jwks"in n&&T(n.jwks)&&Array.isArray(n.jwks.keys)&&Array.prototype.every.call(n.jwks.keys,T)&&ed(e,t?.[l].jwks,t?.[l].uat),o?.has(e)){if({jwks:i,age:s}=o.get(e),s>=300)return ef(e,t?.[l]),ew(e,t,r)}else i=await eQ(e,t).then(eY),s=0,ed(e,i,N(),t?.[l]);switch(c.slice(0,2)){case"RS":case"PS":a="RSA";break;case"ES":a="EC";break;case"Ed":a="OKP";break;default:throw new b}let{0:p,length:h}=i.keys.filter(e=>{if(e.kty!==a||void 0!==u&&u!==e.kid||void 0!==e.alg&&c!==e.alg||void 0!==e.use&&"sig"!==e.use||e.key_ops?.includes("verify")===!1)return!1;switch(!0){case"ES256"===c&&"P-256"!==e.crv:case"ES384"===c&&"P-384"!==e.crv:case"ES512"===c&&"P-521"!==e.crv:case"EdDSA"===c&&!("Ed25519"===e.crv||"Ed448"===e.crv):return!1}return!0});if(!h){if(s>=60)return ef(e,t?.[l]),ew(e,t,r);throw new v("error when selecting a JWT verification key, no applicable keys found")}if(1!==h)throw new v('error when selecting a JWT verification key, multiple applicable keys found, a "kid" JWT Header Parameter is required');let d=await ts(c,p);if("public"!==d.type)throw new v("jwks_uri must only contain public keys");return d}let em=Symbol();function ey(e){return e.headers.get("content-type")?.split(";")[0]}async function eg(e,t,r,n){let i;if(M(e),G(t),!s(n,Response))throw TypeError('"response" must be an instance of Response');if(200!==n.status)throw new v('"response" is not a conform UserInfo Endpoint response');if("application/jwt"===ey(n)){eV(n);let{claims:r,jwt:o}=await e6(await n.text(),te.bind(void 0,t.userinfo_signed_response_alg,e.userinfo_signing_alg_values_supported),e5,H(t),K(t),t[h]).then(eC.bind(void 0,t.client_id)).then(eU.bind(void 0,e.issuer));ek.set(n,o),i=r}else{if(t.userinfo_signed_response_alg)throw new v("JWT UserInfo Response expected");eV(n);try{i=await n.json()}catch(e){throw new v('failed to parse "response" body as JSON',{cause:e})}}if(!T(i))throw new v('"response" body must be a top level object');if(!C(i.sub))throw new v('"response" body "sub" property must be a non-empty string');if(r===em);else{if(!C(r))throw new v('"expectedSubject" must be a non-empty string');if(i.sub!==r)throw new v('unexpected "response" body "sub" value')}return i}async function eb(e,t,r,n,i,o,s){return await Z(e,t,i,o,s?.clientPrivateKey),o.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(s?.[u]||fetch)(n.href,{body:i,headers:Object.fromEntries(o.entries()),method:r,redirect:"manual",signal:s?.signal?j(s.signal):null}).then(R)}async function e_(e,t,r,n,i){let o=en(e,"token_endpoint",ei(t,i));n.set("grant_type",r);let s=E(i?.headers);return s.set("accept","application/json"),i?.DPoP!==void 0&&await Y(s,i.DPoP,o,"POST",H(t)),eb(e,t,"POST",o,n,s,i)}async function ev(e,t,r,n){if(M(e),G(t),!C(r))throw TypeError('"refreshToken" must be a non-empty string');let i=new URLSearchParams(n?.additionalParameters);return i.set("refresh_token",r),e_(e,t,"refresh_token",i,n)}let eS=new WeakMap,ek=new WeakMap;function eP(e){if(!e.id_token)return;let t=eS.get(e);if(!t)throw TypeError('"ref" was already garbage collected or did not resolve from the proper sources');return t[0]}async function eA(e,t,r){let n;if(M(e),!eS.has(t))throw new v('"ref" does not contain an ID Token to verify the signature of');let{0:i,1:o,2:s}=eS.get(t)[1].split("."),a=JSON.parse(m(y(i)));if(a.alg.startsWith("HS"))throw new b;n=await ew(e,r,a),await e8(i,o,n,y(s))}async function eR(e,t,r){let n;if(M(e),!ek.has(t))throw new v('"ref" does not contain a processed JWT Response to verify the signature of');let{0:i,1:o,2:s}=ek.get(t).split("."),a=JSON.parse(m(y(i)));if(a.alg.startsWith("HS"))throw new b;n=await ew(e,r,a),await e8(i,o,n,y(s))}function eT(e,t,r){return eR(e,t,r)}function eE(e,t,r){return eR(e,t,r)}async function ej(e,t,r,n=!1,i=!1){let o;if(M(e),G(t),!s(r,Response))throw TypeError('"response" must be an instance of Response');if(200!==r.status){let e;if(e=await e0(r))return e;throw new v('"response" is not a conform Token Endpoint response')}eV(r);try{o=await r.json()}catch(e){throw new v('failed to parse "response" body as JSON',{cause:e})}if(!T(o))throw new v('"response" body must be a top level object');if(!C(o.access_token))throw new v('"response" body "access_token" property must be a non-empty string');if(!C(o.token_type))throw new v('"response" body "token_type" property must be a non-empty string');if(o.token_type=o.token_type.toLowerCase(),"dpop"!==o.token_type&&"bearer"!==o.token_type)throw new b("unsupported `token_type` value");if(void 0!==o.expires_in&&("number"!=typeof o.expires_in||o.expires_in<=0))throw new v('"response" body "expires_in" property must be a positive number');if(!i&&void 0!==o.refresh_token&&!C(o.refresh_token))throw new v('"response" body "refresh_token" property must be a non-empty string');if(void 0!==o.scope&&"string"!=typeof o.scope)throw new v('"response" body "scope" property must be a string');if(!n){if(void 0!==o.id_token&&!C(o.id_token))throw new v('"response" body "id_token" property must be a non-empty string');if(o.id_token){let{claims:r,jwt:n}=await e6(o.id_token,te.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported),e5,H(t),K(t),t[h]).then(ez.bind(void 0,["aud","exp","iat","iss","sub"])).then(eL.bind(void 0,e.issuer)).then(eO.bind(void 0,t.client_id));if(Array.isArray(r.aud)&&1!==r.aud.length){if(void 0===r.azp)throw new v('ID Token "aud" (audience) claim includes additional untrusted audiences');if(r.azp!==t.client_id)throw new v('unexpected ID Token "azp" (authorized party) claim value')}if(void 0!==r.auth_time&&(!Number.isFinite(r.auth_time)||1!==Math.sign(r.auth_time)))throw new v('ID Token "auth_time" (authentication time) must be a positive number');eS.set(o,[r,n])}}return o}async function ex(e,t,r){return ej(e,t,r)}function eC(e,t){return void 0!==t.claims.aud?eO(e,t):t}function eO(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw new v('unexpected JWT "aud" (audience) claim value')}else if(t.claims.aud!==e)throw new v('unexpected JWT "aud" (audience) claim value');return t}function eU(e,t){return void 0!==t.claims.iss?eL(e,t):t}function eL(e,t){if(t.claims.iss!==e)throw new v('unexpected JWT "iss" (issuer) claim value');return t}let eD=new WeakSet;async function eJ(e,t,r,n,i,o){if(M(e),G(t),!eD.has(r))throw TypeError('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()');if(!C(n))throw TypeError('"redirectUri" must be a non-empty string');if(!C(i))throw TypeError('"codeVerifier" must be a non-empty string');let s=tt(r,"code");if(!s)throw new v('no authorization code in "callbackParameters"');let a=new URLSearchParams(o?.additionalParameters);return a.set("redirect_uri",n),a.set("code_verifier",i),a.set("code",s),e_(e,t,"authorization_code",a,o)}let eq={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation"};function ez(e,t){for(let r of e)if(void 0===t.claims[r])throw new v(`JWT "${r}" (${eq[r]}) claim missing`);return t}let eI=Symbol(),eW=Symbol();async function eH(e,t,r,n,i){let o=await ej(e,t,r);if(es(o))return o;if(!C(o.id_token))throw new v('"response" body "id_token" property must be a non-empty string');i??(i=t.default_max_age??eW);let s=eP(o);if((t.require_auth_time||i!==eW)&&void 0===s.auth_time)throw new v('ID Token "auth_time" (authentication time) claim missing');if(i!==eW){if("number"!=typeof i||i<0)throw TypeError('"maxAge" must be a non-negative number');let e=N()+H(t),r=K(t);if(s.auth_time+i<e-r)throw new v("too much time has elapsed since the last End-User authentication")}switch(n){case void 0:case eI:if(void 0!==s.nonce)throw new v('unexpected ID Token "nonce" claim value');break;default:if(!C(n))throw TypeError('"expectedNonce" must be a non-empty string');if(void 0===s.nonce)throw new v('ID Token "nonce" claim missing');if(s.nonce!==n)throw new v('unexpected ID Token "nonce" claim value')}return o}async function eK(e,t,r){let n=await ej(e,t,r,!0);if(es(n))return n;if(void 0!==n.id_token){if("string"==typeof n.id_token&&n.id_token.length)throw new v("Unexpected ID Token returned, use processAuthorizationCodeOpenIDResponse() for OpenID Connect callback processing");delete n.id_token}return n}function eN(e,t){if("string"!=typeof t.header.typ||t.header.typ.toLowerCase().replace(/^application\//,"")!==e)throw new v('unexpected JWT "typ" header parameter value');return t}async function e$(e,t,r,n){return M(e),G(t),e_(e,t,"client_credentials",new URLSearchParams(r),n)}async function eM(e,t,r,n,i){if(M(e),G(t),!C(r))throw TypeError('"grantType" must be a non-empty string');return e_(e,t,r,new URLSearchParams(n),i)}async function eG(e,t,r){let n=await ej(e,t,r,!0,!0);return es(n),n}async function eF(e,t,r,n){if(M(e),G(t),!C(r))throw TypeError('"token" must be a non-empty string');let i=en(e,"revocation_endpoint",ei(t,n)),o=new URLSearchParams(n?.additionalParameters);o.set("token",r);let s=E(n?.headers);return s.delete("accept"),eb(e,t,"POST",i,o,s,n)}async function eB(e){if(!s(e,Response))throw TypeError('"response" must be an instance of Response');if(200!==e.status){let t;if(t=await e0(e))return t;throw new v('"response" is not a conform Revocation Endpoint response')}}function eV(e){if(e.bodyUsed)throw TypeError('"response" body has been used already')}async function eZ(e,t,r,n){if(M(e),G(t),!C(r))throw TypeError('"token" must be a non-empty string');let i=en(e,"introspection_endpoint",ei(t,n)),o=new URLSearchParams(n?.additionalParameters);o.set("token",r);let s=E(n?.headers);return n?.requestJwtResponse??t.introspection_signed_response_alg?s.set("accept","application/token-introspection+jwt"):s.set("accept","application/json"),eb(e,t,"POST",i,o,s,n)}async function eX(e,t,r){let n;if(M(e),G(t),!s(r,Response))throw TypeError('"response" must be an instance of Response');if(200!==r.status){let e;if(e=await e0(r))return e;throw new v('"response" is not a conform Introspection Endpoint response')}if("application/token-introspection+jwt"===ey(r)){eV(r);let{claims:i,jwt:o}=await e6(await r.text(),te.bind(void 0,t.introspection_signed_response_alg,e.introspection_signing_alg_values_supported),e5,H(t),K(t),t[h]).then(eN.bind(void 0,"token-introspection+jwt")).then(ez.bind(void 0,["aud","iat","iss"])).then(eL.bind(void 0,e.issuer)).then(eO.bind(void 0,t.client_id));if(ek.set(r,o),!T(n=i.token_introspection))throw new v('JWT "token_introspection" claim must be a JSON object')}else{eV(r);try{n=await r.json()}catch(e){throw new v('failed to parse "response" body as JSON',{cause:e})}if(!T(n))throw new v('"response" body must be a top level object')}if("boolean"!=typeof n.active)throw new v('"response" body "active" property must be a boolean');return n}async function eQ(e,t){M(e);let r=en(e,"jwks_uri"),n=E(t?.headers);return n.set("accept","application/json"),n.append("accept","application/jwk-set+json"),(t?.[u]||fetch)(r.href,{headers:Object.fromEntries(n.entries()),method:"GET",redirect:"manual",signal:t?.signal?j(t.signal):null}).then(R)}async function eY(e){let t;if(!s(e,Response))throw TypeError('"response" must be an instance of Response');if(200!==e.status)throw new v('"response" is not a conform JSON Web Key Set response');eV(e);try{t=await e.json()}catch(e){throw new v('failed to parse "response" body as JSON',{cause:e})}if(!T(t))throw new v('"response" body must be a top level object');if(!Array.isArray(t.keys))throw new v('"response" body "keys" property must be an array');if(!Array.prototype.every.call(t.keys,T))throw new v('"response" body "keys" property members must be JWK formatted objects');return t}async function e0(e){if(e.status>399&&e.status<500){eV(e);try{let t=await e.json();if(T(t)&&"string"==typeof t.error&&t.error.length)return void 0!==t.error_description&&"string"!=typeof t.error_description&&delete t.error_description,void 0!==t.error_uri&&"string"!=typeof t.error_uri&&delete t.error_uri,void 0!==t.algs&&"string"!=typeof t.algs&&delete t.algs,void 0!==t.scope&&"string"!=typeof t.scope&&delete t.scope,t}catch{}}}function e1(e){if("number"!=typeof e.modulusLength||e.modulusLength<2048)throw new v(`${e.name} modulusLength must be at least 2048 bits`)}function e2(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){switch(e){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new b}}(e.algorithm.namedCurve)};case"RSA-PSS":switch(e1(e.algorithm),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new b}case"RSASSA-PKCS1-v1_5":return e1(e.algorithm),e.algorithm.name;case"Ed448":case"Ed25519":return e.algorithm.name}throw new b}let e5=Symbol();async function e8(e,t,r,n){let i=`${e}.${t}`;if(!await crypto.subtle.verify(e2(r),r,n,m(i)))throw new v("JWT signature verification failed")}async function e6(e,t,r,n,i,o){let s,a,c,{0:u,1:p,2:h,length:l}=e.split(".");if(5===l){if(void 0!==o)e=await o(e),{0:u,1:p,2:h,length:l}=e.split(".");else throw new b("JWE structure JWTs are not supported")}if(3!==l)throw new v("Invalid JWT");try{s=JSON.parse(m(y(u)))}catch(e){throw new v("failed to parse JWT Header body as base64url encoded JSON",{cause:e})}if(!T(s))throw new v("JWT Header must be a top level object");if(t(s),void 0!==s.crit)throw new v('unexpected JWT "crit" header parameter');let d=y(h);r!==e5&&(a=await r(s),await e8(u,p,a,d));try{c=JSON.parse(m(y(p)))}catch(e){throw new v("failed to parse JWT Payload body as base64url encoded JSON",{cause:e})}if(!T(c))throw new v("JWT Payload must be a top level object");let f=N()+n;if(void 0!==c.exp){if("number"!=typeof c.exp)throw new v('unexpected JWT "exp" (expiration time) claim type');if(c.exp<=f-i)throw new v('unexpected JWT "exp" (expiration time) claim value, timestamp is <= now()')}if(void 0!==c.iat&&"number"!=typeof c.iat)throw new v('unexpected JWT "iat" (issued at) claim type');if(void 0!==c.iss&&"string"!=typeof c.iss)throw new v('unexpected JWT "iss" (issuer) claim type');if(void 0!==c.nbf){if("number"!=typeof c.nbf)throw new v('unexpected JWT "nbf" (not before) claim type');if(c.nbf>f+i)throw new v('unexpected JWT "nbf" (not before) claim value, timestamp is > now()')}if(void 0!==c.aud&&"string"!=typeof c.aud&&!Array.isArray(c.aud))throw new v('unexpected JWT "aud" (audience) claim type');return{header:s,claims:c,signature:d,key:a,jwt:e}}async function e3(e,t,r,n,i){if(M(e),G(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw TypeError('"parameters" must be an instance of URLSearchParams, or URL');let o=tt(r,"response");if(!o)throw new v('"parameters" does not contain a JARM response');let{claims:s}=await e6(o,te.bind(void 0,t.authorization_signed_response_alg,e.authorization_signing_alg_values_supported),ew.bind(void 0,e,i),H(t),K(t),t[h]).then(ez.bind(void 0,["aud","exp","iss"])).then(eL.bind(void 0,e.issuer)).then(eO.bind(void 0,t.client_id)),a=new URLSearchParams;for(let[e,t]of Object.entries(s))"string"==typeof t&&"aud"!==e&&a.set(e,t);return ti(e,t,a,n)}async function e4(e,t,r){let n;switch(e){case"RS256":case"PS256":case"ES256":n="SHA-256";break;case"RS384":case"PS384":case"ES384":n="SHA-384";break;case"RS512":case"PS512":case"ES512":n="SHA-512";break;case"EdDSA":if("Ed25519"===r.algorithm.name){n="SHA-512";break}throw new b;default:throw new b}let i=await crypto.subtle.digest(n,m(t));return y(i.slice(0,i.byteLength/2))}async function e7(e,t,r,n){return t===await e4(r,e,n)}async function e9(e,t,r,n,i,o,s){if(M(e),G(t),r instanceof URL){if(!r.hash.length)throw TypeError('"parameters" as an instance of URL must contain a hash (fragment) with the Authorization Response parameters');r=new URLSearchParams(r.hash.slice(1))}if(!(r instanceof URLSearchParams))throw TypeError('"parameters" must be an instance of URLSearchParams');let a=tt(r=new URLSearchParams(r),"id_token");switch(r.delete("id_token"),i){case void 0:case tn:break;default:if(!C(i))throw TypeError('"expectedState" must be a non-empty string')}let c=ti({...e,authorization_response_iss_parameter_supported:!1},t,r,i);if(es(c))return c;if(!a)throw new v('"parameters" does not contain an ID Token');let u=tt(r,"code");if(!u)throw new v('"parameters" does not contain an Authorization Code');let p=["aud","exp","iat","iss","sub","nonce","c_hash"];"string"==typeof i&&p.push("s_hash");let{claims:l,header:d,key:f}=await e6(a,te.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported),ew.bind(void 0,e,s),H(t),K(t),t[h]).then(ez.bind(void 0,p)).then(eL.bind(void 0,e.issuer)).then(eO.bind(void 0,t.client_id)),w=H(t),m=N()+w;if(l.iat<m-3600)throw new v('unexpected JWT "iat" (issued at) claim value, it is too far in the past');if("string"!=typeof l.c_hash||await e7(u,l.c_hash,d.alg,f)!==!0)throw new v('invalid ID Token "c_hash" (code hash) claim value');if(void 0!==l.s_hash&&"string"!=typeof i)throw new v('could not verify ID Token "s_hash" (state hash) claim value');if("string"==typeof i&&("string"!=typeof l.s_hash||await e7(i,l.s_hash,d.alg,f)!==!0))throw new v('invalid ID Token "s_hash" (state hash) claim value');if(void 0!==l.auth_time&&(!Number.isFinite(l.auth_time)||1!==Math.sign(l.auth_time)))throw new v('ID Token "auth_time" (authentication time) must be a positive number');if(o??(o=t.default_max_age??eW),(t.require_auth_time||o!==eW)&&void 0===l.auth_time)throw new v('ID Token "auth_time" (authentication time) claim missing');if(o!==eW){if("number"!=typeof o||o<0)throw TypeError('"maxAge" must be a non-negative number');let e=N()+H(t),r=K(t);if(l.auth_time+o<e-r)throw new v("too much time has elapsed since the last End-User authentication")}if(!C(n))throw TypeError('"expectedNonce" must be a non-empty string');if(l.nonce!==n)throw new v('unexpected ID Token "nonce" claim value');if(Array.isArray(l.aud)&&1!==l.aud.length){if(void 0===l.azp)throw new v('ID Token "aud" (audience) claim includes additional untrusted audiences');if(l.azp!==t.client_id)throw new v('unexpected ID Token "azp" (authorized party) claim value')}return c}function te(e,t,r){if(void 0!==e){if(r.alg!==e)throw new v('unexpected JWT "alg" header parameter');return}if(Array.isArray(t)){if(!t.includes(r.alg))throw new v('unexpected JWT "alg" header parameter');return}if("RS256"!==r.alg)throw new v('unexpected JWT "alg" header parameter')}function tt(e,t){let{0:r,length:n}=e.getAll(t);if(n>1)throw new v(`"${t}" parameter must be provided only once`);return r}let tr=Symbol(),tn=Symbol();function ti(e,t,r,n){var i;if(M(e),G(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw TypeError('"parameters" must be an instance of URLSearchParams, or URL');if(tt(r,"response"))throw new v('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()');let o=tt(r,"iss"),s=tt(r,"state");if(!o&&e.authorization_response_iss_parameter_supported)throw new v('response parameter "iss" (issuer) missing');if(o&&o!==e.issuer)throw new v('unexpected "iss" (issuer) response parameter value');switch(n){case void 0:case tn:if(void 0!==s)throw new v('unexpected "state" response parameter encountered');break;case tr:break;default:if(!C(n))throw new v('"expectedState" must be a non-empty string');if(void 0===s)throw new v('response parameter "state" missing');if(s!==n)throw new v('unexpected "state" response parameter value')}let a=tt(r,"error");if(a)return{error:a,error_description:tt(r,"error_description"),error_uri:tt(r,"error_uri")};let c=tt(r,"id_token"),u=tt(r,"token");if(void 0!==c||void 0!==u)throw new b("implicit and hybrid flows are not supported");return i=new URLSearchParams(r),eD.add(i),i}function to(e,t){switch(e){case"PS256":case"PS384":case"PS512":return{name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`};case"RS256":case"RS384":case"RS512":return{name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`};case"ES256":case"ES384":return{name:"ECDSA",namedCurve:`P-${e.slice(-3)}`};case"ES512":return{name:"ECDSA",namedCurve:"P-521"};case"EdDSA":switch(t){case"Ed25519":case"Ed448":return t;default:throw new b}default:throw new b}}async function ts(e,t){let{ext:r,key_ops:n,use:i,...o}=t;return crypto.subtle.importKey("jwk",o,to(e,t.crv),!0,["verify"])}async function ta(e,t,r,n){M(e),G(t);let i=en(e,"device_authorization_endpoint",ei(t,n)),o=new URLSearchParams(r);o.set("client_id",t.client_id);let s=E(n?.headers);return s.set("accept","application/json"),eb(e,t,"POST",i,o,s,n)}async function tc(e,t,r){let n;if(M(e),G(t),!s(r,Response))throw TypeError('"response" must be an instance of Response');if(200!==r.status){let e;if(e=await e0(r))return e;throw new v('"response" is not a conform Device Authorization Endpoint response')}eV(r);try{n=await r.json()}catch(e){throw new v('failed to parse "response" body as JSON',{cause:e})}if(!T(n))throw new v('"response" body must be a top level object');if(!C(n.device_code))throw new v('"response" body "device_code" property must be a non-empty string');if(!C(n.user_code))throw new v('"response" body "user_code" property must be a non-empty string');if(!C(n.verification_uri))throw new v('"response" body "verification_uri" property must be a non-empty string');if("number"!=typeof n.expires_in||n.expires_in<=0)throw new v('"response" body "expires_in" property must be a positive number');if(void 0!==n.verification_uri_complete&&!C(n.verification_uri_complete))throw new v('"response" body "verification_uri_complete" property must be a non-empty string');if(void 0!==n.interval&&("number"!=typeof n.interval||n.interval<=0))throw new v('"response" body "interval" property must be a positive number');return n}async function tu(e,t,r,n){if(M(e),G(t),!C(r))throw TypeError('"deviceCode" must be a non-empty string');let i=new URLSearchParams(n?.additionalParameters);return i.set("device_code",r),e_(e,t,"urn:ietf:params:oauth:grant-type:device_code",i,n)}async function tp(e,t,r){return ej(e,t,r)}async function th(e,t){if(!C(e))throw TypeError('"alg" must be a non-empty string');let r=to(e,"EdDSA"===e?t?.crv??"Ed25519":void 0);return(e.startsWith("PS")||e.startsWith("RS"))&&Object.assign(r,{modulusLength:t?.modulusLength??2048,publicExponent:new Uint8Array([1,0,1])}),crypto.subtle.generateKey(r,t?.extractable??!1,["sign","verify"])}function tl(e){let t=new URL(e);return t.search="",t.hash="",t.href}async function td(e,t,r,n,i){let o=t.headers.get("dpop");if(null===o)throw new v("operation indicated DPoP use but the request has no DPoP HTTP Header");if(t.headers.get("authorization")?.toLowerCase().startsWith("dpop ")===!1)throw new v("operation indicated DPoP use but the request's Authorization HTTP Header scheme is not DPoP");if("string"!=typeof n.cnf?.jkt)throw new v("operation indicated DPoP use but the JWT Access Token has no jkt confirmation claim");let s=H(i),a=await e6(o,te.bind(void 0,void 0,e?.dpop_signing_alg_values_supported||A),async({jwk:e,alg:t})=>{if(!e)throw new v("DPoP Proof is missing the jwk header parameter");let r=await ts(t,e);if("public"!==r.type)throw new v("DPoP Proof jwk header parameter must contain a public key");return r},s,K(i),void 0).then(eN.bind(void 0,"dpop+jwt")).then(ez.bind(void 0,["iat","jti","ath","htm","htu"]));if(Math.abs(N()+s-a.claims.iat)>300)throw new v("DPoP Proof iat is not recent enough");if(a.claims.htm!==t.method)throw new v("DPoP Proof htm mismatch");if("string"!=typeof a.claims.htu||tl(a.claims.htu)!==tl(t.url))throw new v("DPoP Proof htu mismatch");{let e=y(await crypto.subtle.digest("SHA-256",f.encode(r)));if(a.claims.ath!==e)throw new v("DPoP Proof ath mismatch")}{let e;switch(a.header.jwk.kty){case"EC":e={crv:a.header.jwk.crv,kty:a.header.jwk.kty,x:a.header.jwk.x,y:a.header.jwk.y};break;case"OKP":e={crv:a.header.jwk.crv,kty:a.header.jwk.kty,x:a.header.jwk.x};break;case"RSA":e={e:a.header.jwk.e,kty:a.header.jwk.kty,n:a.header.jwk.n};break;default:throw new b}let t=y(await crypto.subtle.digest("SHA-256",f.encode(JSON.stringify(e))));if(n.cnf.jkt!==t)throw new v("JWT Access Token confirmation mismatch")}}async function tf(e,t,r,n){if(M(e),!s(t,Request))throw TypeError('"request" must be an instance of Request');if(!C(r))throw new v('"expectedAudience" must be a non-empty string');let i=t.headers.get("authorization");if(null===i)throw new v('"request" is missing an Authorization HTTP Header');let{0:o,1:a,length:c}=i.split(" ");switch(o=o.toLowerCase()){case"dpop":case"bearer":break;default:throw new b("unsupported Authorization HTTP Header scheme")}if(2!==c)throw new v("invalid Authorization HTTP Header format");let u=["iss","exp","aud","sub","iat","jti","client_id"];(n?.requireDPoP||"dpop"===o||t.headers.has("dpop"))&&u.push("cnf");let{claims:p}=await e6(a,te.bind(void 0,void 0,A),ew.bind(void 0,e,n),H(n),K(n),void 0).then(eN.bind(void 0,"at+jwt")).then(ez.bind(void 0,u)).then(eL.bind(void 0,e.issuer)).then(eO.bind(void 0,r));for(let e of["client_id","jti","sub"])if("string"!=typeof p[e])throw new v(`unexpected JWT "${e}" claim type`);if("cnf"in p){if(!T(p.cnf))throw new v('unexpected JWT "cnf" (confirmation) claim value');let{0:e,length:t}=Object.keys(p.cnf);if(t){if(1!==t)throw new b("multiple confirmation claims are not supported");if("jkt"!==e)throw new b("unsupported JWT Confirmation method")}}return(n?.requireDPoP||"dpop"===o||p.cnf?.jkt!==void 0||t.headers.has("dpop"))&&await td(e,t,a,p,n),p}let tw=u,tm=u,ty=d,tg=d,tb=(...e)=>e9(...e),t_=(...e)=>tf(...e),tv=(...e)=>(function(e,t,r){return eR(e,t,r)})(...e),tS=l}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,211,817],()=>r(21820));module.exports=n})();